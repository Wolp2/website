<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fitness Log</title>
  <link rel="stylesheet" href="style.css"/>

  <style>
    /* ====== Page-specific styling (keeps your base style.css intact) ====== */
    .wrap {max-width: 900px; margin: 0 auto;}
    .badge {
      display: inline-block; padding: 4px 10px; border-radius: 999px;
      font-size: .85rem; font-weight: 700; color: #fff; letter-spacing:.2px;
    }
    .cat-push  { background:#e35151; }
    .cat-pull  { background:#3b82f6; }
    .cat-legs  { background:#10b981; }
    .cat-cardio{ background:#8b5cf6; }
    .cat-other { background:#6b7280; }

    .card {
      background:#fff; border-radius:12px; padding:16px 16px 8px; margin:16px 0;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    .card h3 { margin:0 0 6px; }
    .muted { color:#666; font-size:.9rem; }

    .exercise-list li {
    display: grid;
    grid-template-columns: 1fr 100px 100px; /* consistent column widths */
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px solid #eee;
    }
    .exercise-list li:last-child { border-bottom: none; }

    /* Optional tweak: make headers bold + aligned */
    .exercise-list li.header {
    font-weight: 700;
    border-bottom: 2px solid #ccc;
    }
    .exercise-list li.header .tag {
    background: none;
    text-align: center;
    }

    @media (max-width:600px){
      .exercise-list li { grid-template-columns: 1fr 1fr; }
      .exercise-list li .reps { justify-self:end; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Here is a personal log of my workouts<br> 
        I do not have a weight/lift goal<br>
        My main concern is living a healthy lifestyle!</h1>
    <p>Data is Live using Google Sheets</p>
  </header>

  <div id="navbar"></div>

    <script>
        fetch("nav.html")
            .then(res => res.text())
            .then(html => document.getElementById("navbar").innerHTML = html)
            .catch(err => console.error("Failed to load nav:", err));
    </script>

  <main class="wrap">
    <!-- Latest Workout -->
    <section id="latest" class="card latest" aria-live="polite"></section>

    <!-- History -->
    <h2 style="margin-top:28px;">Workout History</h2>
    <section id="history"></section>
  </main>

  <footer>
    <p>&copy; 2025 William Lopez. All rights reserved.</p>
  </footer>

  <script>
  // ===== 1) Published CSV link =====
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQZlEe5gpor6F0j6tRvsPrYhdrjOENGut0jUPdqTtyNYdefmRO72v1ogD9rLcUHN1HIJbMzkSfVNmRE/pub?gid=0&single=true&output=csv";

  // ===== 2) Small helpers =====
  const trim = s => (s ?? "").toString().trim();

  function parseMDY(str){
    const m = /^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})$/.exec(trim(str));
    if(!m) return null;
    let [_, mm, dd, yy] = m.map(Number);
    if (yy < 100) yy += 2000;
    return new Date(yy, mm-1, dd);
  }

  function inferCategory(exercise){
    const e = (exercise||"").toLowerCase();
    if (/(bench|shoulder|tricep|overhead|dip|push)/.test(e)) return "Push";
    if (/(row|pullup|curl|lat|bicep|hamstring|deadlift)/.test(e)) return "Pull";
    if (/(squat|leg|calf|lunge)/.test(e)) return "Legs";
    if (/(run|cardio|bike|treadmill|mile)/.test(e)) return "Cardio";
    return "Other";
  }

  function catClass(cat){
    const c = (cat||"").toLowerCase();
    if (c==="push") return "cat-push";
    if (c==="pull") return "cat-pull";
    if (c==="legs") return "cat-legs";
    if (c==="cardio") return "cat-cardio";
    return "cat-other";
  }

  function parseCSV(text){
    return text.trim().split(/\r?\n/).map(line => line.split(",").map(cell => cell.trim()));
  }

  // ===== 3) RENDERERS =====
  function renderLatest(day){
    if(!day){ document.getElementById("latest").style.display="none"; return; }

    const badge = `<span class="badge ${catClass(day.category)}">${day.category||"Other"}</span>`;

    // add header row for clarity
    const headerRow = `
        <li style="font-weight:700; border-bottom:2px solid #ddd;">
        <span class="exercise">Exercise</span>
        <span class="tag" style="background:none; font-weight:700;">Weight</span>
        <span class="tag reps" style="background:none; font-weight:700;">Reps/Sets</span>
        </li>
    `;

    const list = day.items.map(it => `
        <li>
        <span class="exercise">${it.exercise}</span>
        <span class="tag">${it.weight||"-"}</span>
        <span class="tag reps">${it.reps||"-"}</span>
        </li>
    `).join("");

    document.getElementById("latest").innerHTML = `
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
        <h2 style="margin:0;">Latest Workout — ${day.dateStr}</h2>${badge}
        </div>
        <ul class="exercise-list">${headerRow}${list}</ul>
    `;
    }

  function renderHistory(days){
    const host = document.getElementById("history");
    host.innerHTML = days.map(day => {
        const badge = `<span class="badge ${catClass(day.category)}">${day.category||"Other"}</span>`;
        const headerRow = `
        <li style="font-weight:700; border-bottom:2px solid #ddd;">
            <span class="exercise">Exercise</span>
            <span class="tag" style="background:none; font-weight:700;">Weight</span>
            <span class="tag reps" style="background:none; font-weight:700;">Reps/Sets</span>
        </li>
        `;
        const list = day.items.map(it => `
            <li>
            <span class="exercise">${it.exercise}</span>
            <span class="tag">${it.weight||"-"}</span>
            <span class="tag reps">${it.reps||"-"}</span>
            </li>
        `).join("");
        return `
        <article class="card">
            <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
            <h3>${day.dateStr}</h3>${badge}
            </div>
            <ul class="exercise-list">${headerRow}${list}</ul>
        </article>
        `;
    }).join("");
    }

  // ===== 4) Fetch + transform =====
  fetch(SHEET_URL, {mode: "cors"})
    .then(res => {
      if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
      return res.text();
    })
    .then(csv => {
      const rows = parseCSV(csv);
      if (rows.length < 2) throw new Error("CSV has no data rows.");

      // Header matching
      const header = rows[0].map(h => h.toLowerCase().replace(/\s+/g, ""));
      const findCol = (name) => header.indexOf(name);

      const iDate = findCol("date");
      const iCat  = findCol("category");      // may be -1
      const iEx   = findCol("exercise");
      const iW    = findCol("weight");
      const iR    = findCol("reps/sets".replace(/\s+/g,""));

      if ([iDate,iEx,iW,iR].some(i => i === -1)) {
        throw new Error(`Missing required columns. Found header: [${rows[0].join(", ")}]`);
      }

      // Carry-forward logic for blank Date/Category
      let lastDate="", lastCat="";
      const entries = [];
      for (let i=1; i<rows.length; i++){
        const r = rows[i];
        if (!r.length || r.every(c => !trim(c))) continue;

        let d = trim(r[iDate]);
        let c = iCat>=0 ? trim(r[iCat]) : "";
        const ex = trim(r[iEx]);
        const w  = trim(r[iW]);
        const re = trim(r[iR]);

        if (d) lastDate = d; else d = lastDate;
        if (c) lastCat = c;  else c = lastCat || inferCategory(ex);
        if (!d || !ex) continue;

        entries.push({
          dateStr: d, dateObj: parseMDY(d) || new Date(d),
          category: c, exercise: ex, weight: w, reps: re
        });
      }

      // Group rows by date
      const byDate = {};
      entries.forEach(e => {
        const key = e.dateStr;
        if (!byDate[key]) byDate[key] = { dateStr: key, dateObj: e.dateObj, category: e.category, items: [] };
        if (!byDate[key].category && e.category) byDate[key].category = e.category;
        byDate[key].items.push({exercise:e.exercise, weight:e.weight, reps:e.reps, cat:e.category});
      });

      const days = Object.values(byDate).sort((a,b) => b.dateObj - a.dateObj);
      renderLatest(days[0]);
      renderHistory(days);
    })
    .catch(err => {
      console.error("Sheet load error:", err);
      document.getElementById("latest").innerHTML =
        `<p><strong>Couldn’t load the workout sheet.</strong><br>${err.message}</p>
         <p>Checklist:<br>
         1) Open via <code>http://localhost…</code> (Live Server or <code>python -m http.server</code>)<br>
         2) Publish the specific tab as CSV (URL has <code>gid=…&output=csv</code>)</p>`;
    });
</script>
</body>
</html>
